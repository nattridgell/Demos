<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/google-apis/google-apis.html">
<link rel="import" href="bower_components/google-map/google-map.html">

<!--
<polymer-element name="google-map-highlighter-marker" extends="google-map-marker" attributes="placeId icon">
<template>
<shadow></shadow>
</template>
<script>
( function() {
    Polymer({
      placeId: null,
      title: null,
      mapReady: function() {
        this.updateLocation();
        this.super();
      },

    });
})();

</script>
</polymer-element>
-->
<polymer-element name="google-map-highlighter-map" extends="google-map" attributes="apiKey latitude longitude zoom showCenterMarker version map mapType disableDefaultUI fitToMarkers zoomable styles maxZoom minZoom libraries signedIn language placeId ">
<template>
  <shadow></shadow>
 <!-- Only include the following line if standard google-map-marker 's are no longer being used
  <content id="markers" select="google-map-highlighter-marker"></content> -->
</template>
<script>
    Polymer({
      placeId: null,

      updateLocation: function() {
window.console.log("I am inside update location");
          var service = new google.maps.places.PlacesService(this.map);
          service.getDetails({placeId: this.placeId}, function(place, status) {
window.console.log("I am inside update location - get Details");
            if (status == google.maps.places.PlacesServiceStatus.OK) {
              this.latitude = place.geometry.location.lat();
              this.longitude = place.geometry.location.lng();
              this.name = place.name; // TODO: Check the syntax for icon declaration
window.console.log("I am inside update location - get Details with lat: " + this.latitude);
              this.asyncFire('google-map-ready', place);
            }
          }.bind(this));
      },

      mapApiLoaded: function() {
window.console.log("I am inside mapApiLoaded");
        this.map = new google.maps.Map(this.$.map, this.getMapOptions());
        this.updateLocation();
        this.updateCenter();
        this.addMapListeners();
      },
    });

</script>
</polymer-element>






<polymer-element name="google-map-highlighter" attributes="apiKey map name placeId latitude longitude details">
<template>

  <style>
    :host {
      position: relative;
      display: block;
      height: 100%;
    }

    #map {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      visibility:hidden;
    }

  </style>

 <!-- <google-maps-api apiKey="{{apiKey}}" version='3.exp' on-api-load="{{updateLocation}}" libraries="places"></google-maps-api> -->
<div id="map">
  <google-map-highlighter-map map="{{map}}" zoom="14" placeId="{{placeId}}"  on-google-map-ready="{{mapReady}}">
     <google-map-marker id="marker" latitude="{{latitude}}" longitude="{{longitude}}" name="{{name}}"></google-map-marker> </google-map-highlighter-map>
</div>

</template>
<script>
Polymer({
    /**
     * A latitude to put the marker on and centre, calculated if an address is given.
     *
     * @attribute latitude
     * @type number
     * @default 37.77493
     */
    latitude: 0,

    /**
     * A longitude to put the marker on and centre, calculated if an address is given.
     *
     * @attribute longitude
     * @type number
     * @default -122.41942
     */
    longitude: 0,

    /**
     * The phone number/contact details of the place being highlighted (optional).
     *
     * @attribute phoneNumber
     * @type string
     * @default null
     */
    contact: null,

    /**
     * Name of the place being highlighted.
     *
     * @attribute name
     * @type string
     * @default null
     */
    name: null,

    /**
     * If set, removes the map's default UI controls.
     *
     * @attribute disableDefaultUI
     * @type boolean
     * @default false
     */
    disableDefaultUI: false,

    /**
     * If set, allows content for the infowindow to be generated from place_id.
     *
     * @attribute details
     * @type boolean
     * @default true
     */
    details: true,

    apiKey: null,
    content: null,
    map: null,
    marker:null,

    mapReady:  function(place) {
      this.latitude = place.detail.geometry.location.lat();
      this.longitude = place.detail.geometry.location.lng();
      this.name = place.detail.name;
      this.address = place.detail.formatted_address;
      this.website = place.detail.website;
      this.phone = place.detail.formatted_phone_number;
      this.$.map.style.visibility = 'visible';
      this.contentChanged();
    },


    contentChanged: function(){
      var marker = this.$.marker;
	window.console.log(this.details);
      if (this.details) {
	marker.innerHTML =   '<h1>'+this.name+'</h1><p>Address: '+this.address+'<br>Website: <a href="'+this.website+'">google.com.au</a><br>Phone: '+this.phone+'</p>';
      }
	marker.innerHTML = marker.innerHTML+this.innerHTML;
    }
    
  });

</script>
</polymer-element>
